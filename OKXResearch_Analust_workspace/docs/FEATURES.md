# 功能详解 (Features & Capabilities)

本文档详细介绍了 OKX Research Analyst 的各项核心功能、技术原理及使用场景，帮助您充分挖掘本系统的潜力。

---

## 1. 核心功能矩阵

### 1.1 📡 市场数据全景扫描 (Market Scanner)
系统就像一个不知疲倦的市场观察员，实时监控 OKX 交易所的行情动态。

*   **实时连接**: 直接对接 OKX V5 REST API，获取一手 Tick 级别数据。
*   **智能清洗**:
    *   **去噪**: 自动剔除成交量极低、流动性差的“僵尸币”。
    *   **排序**: 基于 `volCcy24h` (24h成交额) 动态排序，锁定市场资金最集中的 Top 30 资产。
*   **多维数据**: 抓取包括最新价、24h 开盘价、24h 成交量等关键字段。

### 1.2 🧠 多模型 AI 分析引擎 (AI Brain)
这是系统的“大脑”。我们不仅仅是调用 API，而是构建了一套完整的 AI 投研工作流。

*   **模型无关性 (Model Agnostic)**:
    *   **默认支持**: DeepSeek-V3 (深度推理能力强)。
    *   **广泛兼容**: 支持所有兼容 OpenAI 接口的模型（如 Moonshot Kimi, GPT-4o, Claude via Proxy）。
    *   **配置灵活**: 通过 `.env` 中的 `LLM_BASE_URL` 和 `LLM_MODEL` 即可一键切换模型厂商。
*   **专业 Prompt 工程**:
    *   内置了经专业调优的 `System Prompt`，强制 AI 输出结构化、数据驱动的分析报告，杜绝“正确的废话”。
    *   要求 AI 输出 Markdown 表格、情感评分和具体的投资建议。
*   **赛道知识增强 (Hybrid Knowledge Base)**:
    *   **静态知识**: 优先读取 `config/coins_data.json` 中的本地配置。
    *   **动态补全**: 对于本地未收录的新币种（如刚上线的热门币），系统会自动调用 LLM 进行实时分类（例如识别出 "PNUT" 属于 Meme 板块），并将结果缓存，确保分析永远紧跟市场热点。

### 1.3 🤖 自动化与调度 (Scheduler)
让系统成为您 24/7 的私人分析师。

*   **双模式运行**:
    *   **单次模式 (One-off)**: 运行一次即退出，适合临时查询或配合 Crontab 使用。
    *   **守护模式 (Daemon)**: 开启 `ENABLE_SCHEDULER=true` 后，程序常驻后台。
*   **灵活启动**:
    *   **前台运行**: 直接运行 `./run.sh`，适合调试，看到实时日志。
    *   **后台运行**: 使用 `./run.sh -d` (Linux/Mac) 或 `run.bat -d` (Windows)，一键将程序放入后台（Windows 下为最小化窗口），不占用当前终端。
*   **灵活调度**:
    *   **定点运行**: 设置 `SCHEDULE_TIME=08:00`，每天早晨准时发送早报。
    *   **间隔运行**: 设置 `SCHEDULE_INTERVAL=30`，每隔 30 分钟进行一次高频扫描。

### 1.4 📢 多渠道消息推送 (Notifications)
不要让价值信息躺在服务器日志里，主动推送到您的手机上。

*   **飞书 (Feishu/Lark)**:
    *   通过 Webhook 推送富文本卡片或 Markdown 消息。
    *   支持群组通知，团队共享研报。
*   **钉钉 (DingTalk)**:
    *   支持自定义关键词安全验证。
    *   完美渲染 AI 生成的 Markdown 表格和加粗字体。

### 1.5 🖥️ 现代化交互终端 (Rich UI)
谁说命令行工具就一定丑陋？我们引入了 `Rich` 库打造极致体验。

*   **实时反馈**: 分析过程中展示 "AI is thinking..." 的动态 Spinner 加载动画，缓解等待焦虑。
*   **精美排版**:
    *   **Panel**: 使用圆角边框包裹核心内容。
    *   **Markdown**: 在终端内直接渲染一级/二级标题、表格、粗体和链接。
    *   **色彩高亮**: 关键日志（Info/Warning/Error）使用不同颜色区分。

---

## 2. ⚡ 技术亮点 (Technical Highlights)

### 2.1 🪵 稳健的日志系统
*   **🔄 自动轮转 (Rotation)**: 采用 `RotatingFileHandler`，单个日志文件限制 10MB，最多保留 5 个备份。即使程序运行一年，也不会占满服务器磁盘。
*   **📊 分级记录**:
    *   `INFO`: 关键流程节点（如“开始抓取”、“分析完成”）。
    *   `ERROR`: 异常堆栈信息，方便排查 API 超时或 Key 错误。

### 2.2 🛡️ 环境隔离与一键启动
*   **🌐 OS Agnostic**: 无论您使用 Windows, macOS 还是 Linux (Ubuntu/CentOS)，都能流畅运行。
*   **📦 自动环境管理**:
    *   提供 `run.bat` (Windows) 和 `run.sh` (Linux/Mac)。
    *   脚本会自动检测并创建 `venv` 虚拟环境，自动安装 `requirements.txt` 依赖。
    *   支持通过 `.env` 自定义虚拟环境名称 (`VENV_NAME`)，避免与其他项目冲突。

### 2.3 🏗️ 配置分层架构
遵循“配置即代码”的最佳实践：
1.  **🔐 隐私层 (`.env`)**: API Key、Webhook URL 等敏感信息，严禁入库。
2.  **💼 业务层 (`coins_data.json`)**: 币种赛道、风险等级等业务规则，热更新，无需改代码。
3.  **⚙️ 代码层 (`settings.py`)**: 路径计算、默认值逻辑，保证系统稳定性。

---

## 3. 🎯 典型使用场景 (Use Cases)

### ☕ 场景 A: 全职交易员的“早报助手”
*   **需求**: 每天起床需要了解昨晚市场发生了什么，哪些板块在领涨。
*   **配置**: `ENABLE_SCHEDULER=true`, `SCHEDULE_TIME=07:30`, 配置飞书 Webhook。
*   **效果**: 每天 7:30，手机飞书收到一份 AI 生成的深度复盘报告，无需打开电脑盯盘。

### 📊 场景 B: 量化开发者的“策略信号源”
*   **需求**: 需要一个模块来判断当前市场情绪（贪婪/恐慌），作为交易策略的过滤器。
*   **用法**: 导入 `src/api/llm_client.py`，直接调用 `analyze_market()` 获取文本分析结果，或者修改 Prompt 让 AI 输出 JSON 格式的情绪分值。

### 📣 场景 C: 社区运营者的“内容生成器”
*   **需求**: 需要定时向社群发送行情分析，活跃气氛。
*   **操作**: 运行 `run.bat "请用幽默风趣的口吻分析，多用 Emoji"`。
*   **效果**: AI 生成一份生动有趣的行情段子，直接转发到社群。
